<!DOCTYPE html>
<!--TODO:
・aria-label="検索"でどう変わるか？
・ViewPort 100vhでどう変わるか？
・sortにアイコンいれる
・sortのフォーカス色消す
・カードの高さ固定にする
・同期処理でのスピナー表示
・ログインユーザーでのお気に入り動作確認
・検索時、XXの検索結果と表示する
-->

<html>
  <head xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8">
    <title>Mini EC | 商品一覧</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/product-list.css}"> 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script th:src="@{/scripts/product-list.js}" defer></script>
  </head>
  <body>
    <header class="shadow-sm">
      <div class="container py-3 d-flex flex-wrap gap-4 align-items-center">
        <span class="fw-bold fs-4 text-dark">Mini&nbsp;EC</span>
        <!-- 検索フォーム -->
        <form id="searchForm" class="d-flex flex-grow-1" method="get" th:action="@{/product}">
          <div class="input-group search-bar">
            <input id="keyword" name="q" class="form-control border-0"
              placeholder="キーワードで検索" th:value="${keywords}">
            <input type="hidden" id="sortHidden" name="sort" th:value="${sort}">
            <button id="searchBtn" class="btn btn-beige" type="submit">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </form>
        
        <!-- お気に入り / カート -->
        <nav class="d-flex align-items-center gap-4">
          <a href="#" class="icon-btn">
            <i  class="bi bi-heart fs-4"></i>
          </a>
          <a href="#" class="icon-btn  position-relative">
            <i class="bi bi-cart fs-4"></i>
            <span id="cartCount" class="badge bg-accent position-absolute top-0 start-100 translate-middle">0</span>
            
          </a>
        </nav>
      </div>
    </header>
  
    <main class="container py-4">
      <!-- 並び替え --> 
      <select id="sortSel" name="sort" class="form-select w-auto">
        <option value="new" th:selected="${sort=='new'}">新着順</option>
        <option value="high" th:selected="${sort=='high'}">価格が高い順</option>
        <option value="low" th:selected="${sort=='low'}">価格が低い順</option>
      </select>
      
      <p th:if="${#lists.isEmpty(dto.products)}">
        該当する商品は見つかりませんでした。
      </p>
      <!-- 商品リスト -->
      <section id="productList" class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
        <div class="col" th:each="p : ${dto.products}">
          <article class="card">
                <a href="#">
            <img th:src="@{/images/{id}.jpeg(id=${p.productId})}" th:alt="${p.productName}">
          </a>
          <div class="card-body">
            <p th:text="${p.productName}">商品名</p>
            <div class="d-flex justify-content-between align-items-end">
              <span class="fw-bold">
                <span th:text="${#numbers.formatInteger(p.price,1,'COMMA')}">0</span><span>円</span>
              </span>
              <button type="button" th:attr="data-product-id=${p.productId}">
                <i class="bi" th:classappend="${p.isFav} ? 'bi-heart-fill' : 'bi-heart'"></i>
              </button>
            </div>
          </div>
          
            <!-- 在庫なし表示  -->
            <p class="text-danger" th:if="${p.outOfStock}">在庫なし</p>
          </article>
        </div>
      </section>
      
       <!-- ページング -->
      <ul class="pagination gap-2 justify-content-center">
        <li class="page-item" th:if="${currentPage > 1}">
          <a class="page-link" th:href="@{/product(page=${currentPage - 1},sort=${sort},q=${keywords})}">
            &#x2039;
          </a>
        </li>
    
        <li class="page-item" th:each="n: ${dto.pageNumbers}" th:classappend="${n == currentPage} ? 'active'">
          <span class="page-link" th:text="${n}" th:if="${n == currentPage}"></span>
          <a class="page-link" th:text="${n}" th:href="@{/product(page=${n},sort=${sort},q=${keywords})}" th:unless="${n == currentPage}"></a>
        </li>
        
        <li class="page-item" th:if="${currentPage < dto.totalPage}">
          <a class="page-link" th:href="@{/product(page=${currentPage + 1},sort=${sort},q=${keywords})}">
            &#x203A;
          </a>
        </li>
      </ul>
      
      <!--  ローディング-->
      <div id="spinner" hidden>Loading</div>
    </main>
  
  </body>
</html>