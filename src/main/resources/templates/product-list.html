<!DOCTYPE html>
<!--TODO:
・aria-label="検索"でどう変わるか？
-->

<html>
<head xmlns:th="http://www.thymeleaf.org">
  <meta charset="UTF-8">
  <title>Mini EC | 商品一覧</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/product-list.css}">
  <script src="/scripts/product-list.js" defer></script>
</head>
<body>
<header class="shadow-sm">
  <div class="container py-3 d-flex flex-wrap gap-4 align-items-center">
    <span class="fw-bold fs-4 text-dark">Mini&nbsp;EC</span>
    <!-- 検索フォーム -->
    <form id="searchForm" class="d-flex flex-grow-1" method="get" th:action="@{/product}" style="background-color: green;">
      <input type="hidden" name="page" th:value="${currentPage}">
      <div class="input-group search-bar">
        <input id="keyword" name="q" class="form-control border-0" placeholder="キーワードで検索" th:value="${keywords}">
        <button id="searchBtn" class="btn btn-beige" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </form>
    
    <!-- お気に入り / カート -->
    <nav style="background-color: purple;">
      <a href="#" class="icon-btn"  style="background-color: yellow;">
        <i style="background-color: blue;" class="bi bi-heart fs-4"></i>
      </a>
      <a href="#" class="icon-btn  position-relative" style="background-color: blue;">
        <i class="bi bi-cart fs-4">
        <span id="cartCount" class="badge"
        style="background-color: red;">0</span>
        </i>
      </a>
    </nav>
  </div>
</header>

<main>
  <!-- 並び替え -->
  <label>並び替え：</label>
  <select id="sortSel" name="sort">
    <option value="new" th:selected="${sort=='new'}">新着順</option>
    <option value="high" th:selected="${sort=='high'}">価格が高い順</option>
    <option value="low" th:selected="${sort=='low'}">価格が低い順</option>
  </select>
  
  <!-- 商品リスト -->
  <section id="productList">
    <article class="item" th:each="p : ${dto.products}">
      <img th:src="@{/images/{id}.jpeg(id=${p.productId})}" th:alt="${p.productName}">
      <p th:text="${p.productName}">商品名</p>
      <!-- 価格 -->
      <p class="price">
        <span th:text="${#numbers.formatInteger(p.price,1,'COMMA')}">0</span> 円
      </p>
      
      <!-- 在庫なし表示 -->
      <p class="stock" th:if="${p.outOfStock}">在庫なし</p>
      <!-- お気に入りボタン -->
      <button class="favBtn" th:text="${p.fav} ? '♥' : '♡'">♡</button>
    </article>
  </section>
  
  <!--  ページング-->
  <ul>
    <!--  前へ-->
    <li>
      <a th:href="@{/product(page=${currentPage - 1},sort=${sort},q=${keywords})}">
        &#x2039;
      </a>
    </li>
  
    <!--  数字-->
    <li th:each="n : ${dto.pageNumbers}">
      <a th:text="${n}"
        th:href="@{/product(page=${n},sort=${sort},q=${keywords})}"></a>
    </li>
    
    <!--  次へ-->
    <li>
      <a th:href="@{/product(page=${currentPage + 1},sort=${sort},q=${keywords})}">
        &#x203A;
      </a>
    </li>
  </ul>
  
  <!--  ローディング-->
  <div id="spinner" hidden>Loading</div>
</main>

</body>
</html>